<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Knight's Tour Puzzle</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #e6f0fa;
        transition: background-color 0.3s, color 0.3s;
    }
    body.dark-mode {
        background-color: #1a2b3c;
        color: #ffffff;
    }
    #gameBoard {
        display: grid;
        gap: 2px;
        background-color: #333;
        padding: 5px;
        margin-top: 20px;
    }
    .cell {
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        border: 1px solid #ccc;
        background-color: #ADD8E6;
        transition: background-color 0.3s;
    }
    .dark-mode .cell {
        background-color: #87CEEB;
        color: #000000;
        border-color: #555;
    }
    .cell:hover {
        filter: brightness(1.2);
    }
    .selected {
        background-color: #28A745 !important;
        color: white !important;
    }
    .valid-move {
        background-color: #FFC107 !important;
        color: black !important;
    }
    #controls, #settings, #leaderboard {
        margin: 20px;
        text-align: center;
    }
    #status {
        margin: 10px;
        font-size: 18px;
        color: #007BFF;
    }
    #gameOver {
        font-size: 48px;
        color: #DC3545;
        font-weight: bold;
        display: none;
        margin: 20px;
    }
    button {
        padding: 10px;
        font-size: 16px;
        margin: 5px;
        cursor: pointer;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
    }
    button:hover {
        background-color: #0056b3;
    }
</style>
</head>
<body>
<h1>Welcome to the Knight's Tour Puzzle, by MO ALi</h1>

<div id="status">Enter your name, choose difficulty, then click a cell to start.</div>
<div id="gameOver">Game Over</div>

<div id="difficulty">
    <label>Difficulty: 
        <select id="difficultyLevel" onchange="setDifficulty()">
            <option value="4x5">Easy (4×5)</option>
            <option value="6x6" selected>Medium (6×6)</option>
            <option value="8x8">Hard (8×8)</option>
        </select>
    </label>
</div>

<div id="gameBoard"></div>

<div id="controls">
    <button onclick="resetGame()">Reset Game</button>
    <button onclick="undoMove()">Undo Move</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
</div>

<div id="settings">
    <label>Font Size: 
        <select id="fontSize" onchange="changeFont()">
            <option value="16">16px</option>
            <option value="18">18px</option>
            <option value="20">20px</option>
            <option value="24" selected>24px</option>
        </select>
    </label>
    <label>Font Type: 
        <select id="fontType" onchange="changeFont()">
            <option value="Arial">Arial</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
            <option value="Verdana">Verdana</option>
        </select>
    </label>
    <label>Text Color: 
        <input type="color" id="textColor" value="#000000" onchange="changeFont()">
    </label>
</div>

<div id="leaderboard">
    <h2>Leaderboard (Top 10)</h2>
    <label>Player Name: <input type="text" id="playerName" maxlength="20"></label>
    <table id="highScores">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Score</th>
                <th>Time (s)</th>
                <th>Max Number</th>
                <th>Board</th>
                <th>Date Played</th>
            </tr>
        </thead>
        <tbody id="scoresBody"></tbody>
    </table>
</div>

<script>
let rows = 6, cols = 6;
let board = [];
let currentNumber = 1;
let gameStarted = false;
let selectedCell = null;
let startTime = null;
let playerName = '';
let highScores = JSON.parse(localStorage.getItem('knightTourHighScores')) || [];
let moveHistory = [];

const knightMoves = [
    [-2, -1], [-2, 1], [-1, -2], [-1, 2],
    [1, -2], [1, 2], [2, -1], [2, 1]
];

function setDifficulty() {
    const value = document.getElementById("difficultyLevel").value;
    if (value === "4x5") { rows = 4; cols = 5; }
    if (value === "6x6") { rows = 6; cols = 6; }
    if (value === "8x8") { rows = 8; cols = 8; }
    resetGame();
}

function initBoard() {
    const gameBoard = document.getElementById('gameBoard');
    gameBoard.innerHTML = '';
    gameBoard.style.gridTemplateColumns = `repeat(${cols}, 60px)`;
    board = Array(rows).fill().map(() => Array(cols).fill(0));
    document.getElementById('gameOver').style.display = 'none';
    moveHistory = [];

    for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.dataset.row = i;
            cell.dataset.col = j;
            cell.addEventListener('click', () => handleCellClick(i, j));
            gameBoard.appendChild(cell);
        }
    }
    updateBoard();
    updateStatus();
    updateLeaderboard();
    changeFont();
}

function handleCellClick(row, col) {
    playerName = document.getElementById('playerName').value.trim() || 'Anonymous';
    if (board[row][col] !== 0) return;

    if (!gameStarted) {
        board[row][col] = currentNumber++;
        gameStarted = true;
        selectedCell = [row, col];
        startTime = Date.now();
        moveHistory.push({ row, col, number: 1 });
        updateBoard();
        highlightValidMoves(row, col);
        updateStatus();
    } else {
        if (isValidKnightMove(selectedCell[0], selectedCell[1], row, col)) {
            board[row][col] = currentNumber++;
            moveHistory.push({ row, col, number: currentNumber - 1 });
            selectedCell = [row, col];
            updateBoard();
            highlightValidMoves(row, col);
            updateStatus();
            checkWinCondition();
            checkGameOver(row, col);
        }
    }
}

function undoMove() {
    if (!gameStarted || moveHistory.length <= 1) return;
    const lastMove = moveHistory.pop();
    board[lastMove.row][lastMove.col] = 0;
    currentNumber--;
    selectedCell = moveHistory.length > 0 ? 
        [moveHistory[moveHistory.length - 1].row, moveHistory[moveHistory.length - 1].col] : null;
    if (moveHistory.length === 0) {
        gameStarted = false;
        startTime = null;
    }
    document.getElementById('gameOver').style.display = 'none';
    updateBoard();
    if (selectedCell) highlightValidMoves(selectedCell[0], selectedCell[1]);
    else document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('selected', 'valid-move'));
    updateStatus();
}

function isValidKnightMove(fromRow, fromCol, toRow, toCol) {
    return knightMoves.some(([dr, dc]) => fromRow + dr === toRow && fromCol + dc === toCol);
}

function highlightValidMoves(row, col) {
    document.querySelectorAll('.cell').forEach(cell => {
        cell.classList.remove('selected', 'valid-move');
    });

    const selected = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
    selected.classList.add('selected');

    for (let [dr, dc] of knightMoves) {
        const newRow = row + dr;
        const newCol = col + dc;
        if (isValidPosition(newRow, newCol) && board[newRow][newCol] === 0) {
            document.querySelector(`.cell[data-row="${newRow}"][data-col="${newCol}"]`).classList.add('valid-move');
        }
    }
}

function isValidPosition(row, col) {
    return row >= 0 && row < rows && col >= 0 && col < cols;
}

function updateBoard() {
    for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
            const cell = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
            if (cell) cell.textContent = board[i][j] === 0 ? '' : board[i][j];
        }
    }
}

function updateStatus() {
    const status = document.getElementById('status');
    if (currentNumber <= rows * cols) {
        status.textContent = `Place number ${currentNumber} using a knight's move.`;
    } else {
        status.textContent = 'Congratulations! You completed the puzzle!';
    }
}

function checkWinCondition() {
    if (currentNumber > rows * cols) {
        endGame();
    }
}

function checkGameOver(row, col) {
    if (!hasValidMoves(row, col) && currentNumber <= rows * cols) {
        endGame(true);
    }
}

function hasValidMoves(row, col) {
    return knightMoves.some(([dr, dc]) => {
        const nr = row + dr, nc = col + dc;
        return isValidPosition(nr, nc) && board[nr][nc] === 0;
    });
}

function endGame(isGameOver = false) {
    const timeTaken = (Date.now() - startTime) / 1000;
    const score = calculateScore(currentNumber - 1, timeTaken);
    saveHighScore(playerName, score, timeTaken, currentNumber - 1);
    if (isGameOver) document.getElementById('gameOver').style.display = 'block';
    document.querySelectorAll('.cell').forEach(cell => {
        cell.style.cursor = 'default';
        cell.classList.remove('valid-move', 'selected');
    });
}

function calculateScore(highestNumber, timeTaken) {
    const maxNumber = rows * cols;
    const progressScore = (highestNumber / maxNumber) * 700;
    const timeScore = ((maxNumber - highestNumber) === 0) 
        ? Math.max(0, 300 - timeTaken)
        : Math.max(0, 300 - (timeTaken / highestNumber * maxNumber));
    return Math.round(Math.min(1000, progressScore + timeScore));
}

function saveHighScore(name, score, time, maxNum) {
    const boardSize = `${rows}x${cols}`;
    const datePlayed = new Date().toLocaleString();
    highScores.push({ name, score, time, maxNum, boardSize, datePlayed });
    highScores.sort((a, b) => {
        if (b.maxNum === a.maxNum) {
            if (a.time === b.time) return b.score - a.score;
            return a.time - b.time;
        }
        return b.maxNum - a.maxNum;
    });
    highScores = highScores.slice(0, 10); // Top 10
    localStorage.setItem('knightTourHighScores', JSON.stringify(highScores));
    updateLeaderboard();
}

function updateLeaderboard() {
    const scoresBody = document.getElementById('scoresBody');
    scoresBody.innerHTML = '';
    highScores.forEach((entry, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${index + 1}</td>
            <td>${entry.name}</td>
            <td>${entry.score}</td>
            <td>${entry.time.toFixed(1)}</td>
            <td>${entry.maxNum}</td>
            <td>${entry.boardSize}</td>
            <td>${entry.datePlayed || ''}</td>
        `;
        scoresBody.appendChild(row);
    });
}

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    updateBoard();
}

function changeFont() {
    const fontSize = document.getElementById('fontSize').value + 'px';
    const fontType = document.getElementById('fontType').value;
    const textColor = document.getElementById('textColor').value;
    document.querySelectorAll('.cell').forEach(cell => {
        cell.style.fontSize = fontSize;
        cell.style.fontFamily = fontType;
        cell.style.color = textColor;
    });
    document.getElementById('status').style.fontSize = fontSize;
    document.getElementById('status').style.fontFamily = fontType;
    document.getElementById('status').style.color = textColor;
}

function resetGame() {
    if (gameStarted && currentNumber > 1 && currentNumber <= rows * cols) {
        const timeTaken = (Date.now() - startTime) / 1000;
        saveHighScore(playerName, calculateScore(currentNumber - 1, timeTaken), timeTaken, currentNumber - 1);
    }
    board = Array(rows).fill().map(() => Array(cols).fill(0));
    currentNumber = 1;
    gameStarted = false;
    selectedCell = null;
    startTime = null;
    moveHistory = [];
    initBoard();
    document.querySelectorAll('.cell').forEach(cell => {
        cell.style.cursor = 'pointer';
        cell.classList.remove('valid-move', 'selected');
    });
}

initBoard();
</script>
</body>
</html>
